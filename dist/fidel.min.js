/*!
  * Fidel - A javascript controller
  * v1.2.2
  * https://github.com/jgallen23/fidel
  * copyright JGA 2011
  * MIT License
  */
!function(a,b){typeof module!="undefined"&&module.exports?module.exports=b():typeof define=="function"&&typeof define.amd=="object"?define(b):this[a]=b()}("Fidel",function(){var a=this,b={};b.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0,c=a==="x"?b:b&3|8;return c.toString(16)}).toUpperCase()},b.extend=function(){throw new Error("Fidel.extend is deprecated, please use Fidel.ViewController.extend")};var c=a.Fidel;b.noConflict=function(){a.Fidel=c;return this};var d=!1,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;b.Class=function(){},b.Class.extend=function(a){function h(a){if(!d){if(this.defaults)for(var c in this.defaults)if(typeof a!="object"||!a[c])this[c]=this.defaults[c];if(typeof a=="object")for(var e in a)this[e]=a[e];this.guid||(this.guid=b.guid()),this._initialize&&this._initialize.apply(this,arguments),this.init&&this.init.apply(this,arguments)}}var c=this.prototype;d=!0;var f=new this;d=!1;for(var g in a)f[g]=typeof a[g]=="function"&&typeof c[g]=="function"&&e.test(a[g])?function(a,b){return function(){var d=this._super;this._super=c[a];var e=b.apply(this,arguments);this._super=d;return e}}(g,a[g]):a[g];h.prototype=f,h.prototype.proxy=function(a){var b=this;return function(){if(!!a)return a.apply(b,arguments)}},h.constructor=h,h.extend=arguments.callee;return h};var f={};b.publish=function(a,b){var c=f[a],d=c?c.length:0;while(d--)c[d].apply(this,b||[])},b.subscribe=function(a,b){f[a]||(f[a]=[]),f[a].push(b);return[a,b]},b.unsubscribe=function(a){var b=f[a[0]],c=a[1],d=b?b.length:0;while(d--)b[d]===c&&b.splice(d,1)},b.Class.prototype.on=b.Class.prototype.bind=function(a,c){return b.subscribe(this.guid+"."+a,this.proxy(c))},b.Class.prototype.emit=b.Class.prototype.trigger=function(a,c){b.publish(this.guid+"."+a,c),b.publish(a,c)},b.Class.prototype.removeListener=b.Class.prototype.unbind=function(a){b.unsubscribe(a)},!function(){var a={};b.template=function b(c,d){var e=/\W/.test(c)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+c.replace(/[\r\t\n]/g,"").split("{!").join("\t").replace(/((^|!})[^\t]*)'/g,"$1\r").replace(/\t=(.*?)!}/g,"',$1,'").split("\t").join("');").split("!}").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):a[c]=a[c]||b(c);return d?e(d):e}}();var g=/^(\w+)\s*(.*)$/,h=b.Class.extend({_initialize:function(a){if(!this.el)throw"el is required";this._subscribeHandles={},this.events&&this.delegateEvents(),this.elements&&this.refreshElements(),this.templates&&this.loadTemplates(),this.actionEvent||(this.actionEvent="click"),this.subscribe&&this.bindSubscriptions(),this.delegateActions(),this.getDataElements()},template:b.template,delegateEvents:function(){for(var a in this.events){var b=this.events[a],c=a.match(g),d=c[1],e=c[2],f=this.proxy(this[b]);e===""?this.el.bind(d,f):this.el.delegate(e,d,f)}},delegateActions:function(){var a=this;this.el.delegate("[data-action]",this.actionEvent,function(b){var c=$(this),d=c.attr("data-action");a[d]&&a[d].call(a,c,b)})},refreshElements:function(){for(var a in this.elements)this[a]=this.find(this.elements[a])},getDataElements:function(){var a=this,b=this.find("[data-element]");for(var c=0,d=b.length;c<d;c++){var e=b[c].getAttribute("data-element");if(!a[e]){var f=this.find('[data-element="'+e+'"]');a[e]=f}}},bindSubscriptions:function(){for(var a in this.subscribe)this._subscribeHandles[a]=b.subscribe(a,this.proxy(this[this.subscribe[a]]))},loadTemplates:function(){for(var a in this.templates)this.templates[a]=$(this.templates[a]).html()},find:function(a){return $(a,this.el[0])},render:function(a,b,c){arguments.length==1&&(b=a,a=this.primaryTemplate),template=this.templates[a];if(!!template){var d=this.template(template,b);c=c?$(c):this.el,c.html(d)}},destroy:function(){for(var a in this._subscribeHandles)b.unsubscribe(this._subscribeHandles[a]);this.el.undelegate("[data-action]",this.actionEvent),this.el=null}});b.ViewController=h;return b})